#!/bin/bash

# Men BarberÃ­a - Script de Build para macOS
# Este script construye la aplicaciÃ³n para distribuciÃ³n en macOS

set -e

# Cambiar al directorio raÃ­z del proyecto
cd "$(dirname "$0")/.."

echo "ğŸ Iniciando build para macOS..."

# Limpiar builds anteriores
echo "ğŸ§¹ Limpiando builds anteriores..."
flutter clean
rm -rf build/

# Obtener dependencias
echo "ğŸ“¦ Obteniendo dependencias..."
flutter pub get

# Generar iconos
echo "ğŸ¨ Generando iconos..."
flutter pub run flutter_launcher_icons:main

# Build para Release
echo "ğŸ”¨ Construyendo aplicaciÃ³n para Release..."
flutter build macos --release

# Verificar que el build fue exitoso
if [ -e "build/macos/Build/Products/Release/men_barberia.app" ]; then
    echo "âœ… Build completado exitosamente!"
    echo "ğŸ“ AplicaciÃ³n disponible en: build/macos/Build/Products/Release/men_barberia.app"
    
    # Mostrar informaciÃ³n del archivo
    echo "ğŸ“Š InformaciÃ³n del build:"
    ls -lah "build/macos/Build/Products/Release/men_barberia.app"
    
    # Opciones post-build
    echo ""
    echo "ğŸ¯ Â¿QuÃ© deseas hacer ahora?"
    echo "1) Instalar en este Mac"
    echo "2) Crear DMG para distribuciÃ³n"
    echo "3) Solo mostrar ubicaciÃ³n"
    echo ""
    read -p "Selecciona una opciÃ³n (1-3): " -n 1 -r
    echo
    
    case $REPLY in
        1)
            echo "ğŸš€ Instalando en este Mac..."
            ./scripts/install_macos.sh
            ;;
        2)
            echo "ğŸ“¦ Creando DMG para distribuciÃ³n..."
            ./scripts/create_simple_dmg.sh
            ;;
        3)
            echo "ğŸ“ La aplicaciÃ³n estÃ¡ lista en: build/macos/Build/Products/Release/men_barberia.app"
            echo "ğŸ’¡ Para instalar manualmente: cp -R 'build/macos/Build/Products/Release/men_barberia.app' '/Applications/'"
            ;;
        *)
            echo "ğŸ“ La aplicaciÃ³n estÃ¡ lista en: build/macos/Build/Products/Release/men_barberia.app"
            ;;
    esac
    
else
    echo "âŒ Error: Build fallÃ³"
    exit 1
fi

echo "ğŸ‰ Proceso completado!"
